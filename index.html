<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>二维码扫描</title>
		<script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
		<script src="https://cdn.jsdelivr.net/npm/html5-qrcode/minified/html5-qrcode.min.js"></script>
		<style>
			.index {
				width: 100%;
				height: 100%;
				overflow: auto;
				position: relative;
			}

			.scan {
				display: flex;
				align-items: center;
				justify-content: center;
				flex-direction: column;
				position: fixed;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				background: #000;
			}

			.scan-box {
				width: 100%;
			}

			.close-scan {
				position: absolute;
				top: 20px;
				right: 20px;
				color: white;
				cursor: pointer;
			}

			.start-scan {
				position: absolute;
				top: calc(50% - 25px);
				left: calc(50% - 100px);
				display: flex;
				align-items: center;
				justify-content: center;
				border: none;
				width: 200px;
				height: 50px;
				background: #00aaff;
				color: #fff;
				border-radius: 10px;
				cursor: pointer;
			}
		</style>
	</head>
	<body>
		<div id="app">
			<div class="index">
				<!-- 扫一扫 -->
				<div class="scan" v-if="isScanning">
					<div class="scan-box">
						<div id="scanning"></div>
					</div>
					<span class="close-scan" @click="stopScan">关闭</span>
				</div>
				<button class="start-scan" v-if="!isScanning" @click="startScan">开始扫一扫</button>
			</div>
		</div>

		<script>
			new Vue({
				el: "#app",
				data: {
					isScanning: false, // 是否正在扫描
					html5QrCode: null, // 存储 Html5Qrcode 实例
				},
				methods: {
					startScan() {
						this.isScanning = true;
						this.$nextTick(() => {
							const qrCodeScanner = new Html5Qrcode("scanning");
							this.html5QrCode = qrCodeScanner;
							qrCodeScanner
								.start({
										facingMode: "environment"
									}, // 后置摄像头
									{
										fps: 10, // 帧率
										qrbox: {
											width: 250,
											height: 250
										}, // 扫描框大小
									},
									(decodedText, decodedResult) => {
										alert("扫描结果：" + decodedText); // 解码成功后的回调
										this.stopScan();
									},
									(errorMessage) => {
										console.log("扫描错误：", errorMessage); // 扫描失败的回调
									}
								)
								.catch((err) => {
									console.error("启动扫描失败：", err);
									this.isScanning = false;
								});
						});
					},
					stopScan() {
						if (this.html5QrCode) {
							this.html5QrCode
								.stop()
								.then(() => {
									this.isScanning = false;
								})
								.catch((err) => {
									console.error("停止扫描失败：", err);
								});
						}
					},
				},
			});
		</script>
	</body>
</html>